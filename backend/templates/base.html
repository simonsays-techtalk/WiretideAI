<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title if title else "Wiretide" }}</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/css/app.css') }}" />
  </head>
  <body>
    <div class="shell">
      <aside class="sidebar">
        <div class="logo">Wiretide</div>
        <nav>
          <a href="/" class="nav-link">Home</a>
          <a href="/api/devices" class="nav-link">Devices API</a>
          <a href="/api/settings" class="nav-link">Settings API</a>
          <a href="/devices" class="nav-link">Devices UI</a>
          <a href="/clients" class="nav-link">Clients</a>
        </nav>
      </aside>
      <main class="content">
        <div class="topbar">
          <div class="breadcrumbs">
            <a href="/" class="link">Home</a>
            <span class="crumb-sep">/</span>
            <span class="crumb-current">{% block pagetitle %}Dashboard{% endblock %}</span>
          </div>
          <div class="user-menu">
            {% if admin_session %}
            <span class="badge admin-pill">Admin</span>
            {% endif %}
            <button class="user-btn" id="userMenuBtn">User â–¾</button>
            <div class="user-dropdown" id="userDropdown">
              <button type="button" id="themeToggle">Toggle Theme</button>
              <a href="#" class="dropdown-link disabled">Change password</a>
              <a href="/logout" class="dropdown-link">Logout</a>
            </div>
          </div>
        </div>
        {% block content %}{% endblock %}
      </main>
    </div>
    <script>
      const dropdown = document.getElementById('userDropdown');
      const btn = document.getElementById('userMenuBtn');
      const themeToggle = document.getElementById('themeToggle');
      const applyTheme = (t) => {
        document.documentElement.setAttribute('data-theme', t);
        localStorage.setItem('wiretide-theme', t);
      };
      const savedTheme = localStorage.getItem('wiretide-theme') || 'dark';
      applyTheme(savedTheme);

      btn?.addEventListener('click', () => {
        dropdown?.classList.toggle('open');
      });
      document.addEventListener('click', (e) => {
        if (!dropdown?.contains(e.target) && e.target !== btn) {
          dropdown?.classList.remove('open');
        }
      });
      themeToggle?.addEventListener('click', () => {
        const current = document.documentElement.getAttribute('data-theme') || 'dark';
        applyTheme(current === 'dark' ? 'light' : 'dark');
      });
    </script>
  </body>
</html>
